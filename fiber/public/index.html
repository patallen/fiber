<!doctype html>
<html>

<head>
    <title>Hello!</title>
</head>

<body>
    <h3>Messages</h3>
    <ul id="event-list">
    </ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
    <script src="./static/js/utils.js"></script>
    <script src="./static/js/models.js"></script>
    <script>
        const socket = io("http://localhost:8080/");
        const messages = [];
        window._events = new EventList();

        const renderList = (name) => {
            if (!window._events.dirty) {
                return
            }
            console.log(name, window._events.length)
            const parent = document.getElementById(name);
            window._events.reverse().map(item => {
                let el = document.createElement("li");
                el.innerText = `Host: ${item.hostname}\tpid: ${item.pid}\ttype: ${item.type}\tuuid: ${item.uuid}`
                parent.appendChild(el);
            })
        }

        socket.on("event", data => {
            const event = TaskEvent.loadObject(data)
            console.log("On Event: ", event['uuid'])
            window._events.push(event)
        });

        window.setInterval(() => renderList("event-list"), 1)

        function sendMessage() {
            socket.emit("message", "HELLO")
        }
    </script>
</body>

</html>
